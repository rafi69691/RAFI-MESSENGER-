name: 24/7 Bot Runner

on:
  schedule:
    - cron: '*/5 * * * *'  # à¦ªà§à¦°à¦¤à¦¿ 5 à¦®à¦¿à¦¨à¦¿à¦Ÿà§‡
  workflow_dispatch:

jobs:
  keep-bot-alive:
    runs-on: ubuntu-latest
    
    steps:
    - name: Start Bot
      run: |
        # Bot à¦¸à§à¦•à§à¦°à¦¿à¦ªà§à¦Ÿ
        cat > bot_runner.sh << 'EOF'
        #!/bin/bash
        echo "ðŸ¤– RAFI BOT STARTING..."
        
        # Bot à¦•à§‹à¦¡
        cat > bot_simple.js << 'BOTCODE'
        const login = require("fca-unofficial");
        
        login({
          email: process.env.FB_EMAIL,
          password: process.env.FB_PASSWORD
        }, (err, api) => {
          if (err) {
            console.log("âŒ Login error:", err.message);
            process.exit(1);
          }
          
          console.log("âœ… Login success!");
          api.setOptions({ listenEvents: true });
          
          api.listenMqtt((err, event) => {
            if (event.body === ".ping") {
              api.sendMessage("ðŸ“ Pong from GitHub!", event.threadID);
            }
          });
          
          // 25 à¦®à¦¿à¦¨à¦¿à¦Ÿ à¦°à¦¾à¦¨ à¦•à¦°à¦¬à§‡
          setTimeout(() => {
            console.log("ðŸ”„ Restarting...");
            process.exit(0);
          }, 25 * 60 * 1000);
        });
        BOTCODE
        
        # Run bot
        node bot_simple.js
        EOF
        
        chmod +x bot_runner.sh
        timeout 1800 ./bot_runner.sh || true
        
    - name: Upload logs
      uses: actions/upload-artifact@v3
      with:
        name: bot-logs
        path: |
          *.log
        retention-days: 1
